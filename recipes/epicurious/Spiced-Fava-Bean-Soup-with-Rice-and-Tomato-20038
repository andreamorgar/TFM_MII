Process onions and garlic in a food processor until finely chopped. Heat oil in a large saucepan over medium-high heat. Add onions and garlic, season with salt and pepper, and cook, stirring often, until softened, about 3 minutes. Add cumin, coriander, and allspice and cook, stirring often, until onions start to brown, about 5 minutes. Add tomatoes and cook, stirring often, until mixture is jammy, about 5 minutes. Stir in broth and bring to a boil. Add beans, reduce heat, and simmer, partially covered, 20 minutes. Add rice and simmer, partially covered, until rice and beans are soft, 30â€“35 minutes; season with salt and pepper. Top soup with yogurt and pistachios just before serving. DO AHEAD: Soup can be made 5 days ahead. Let cool; cover and chill.