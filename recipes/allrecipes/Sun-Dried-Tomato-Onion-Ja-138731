Cook onions, butter, sugar, salt, pepper, and red pepper flakes, covered, in a 10-inch heavy skillet over low heat, stirring occasionally, until onions are soft and pale golden, about 30 minutes. Add wine, vinegar, apricots, and tomatoes and simmer, uncovered, stirring occasionally, until thick, 20 to 30 minutes. Serve at room temperature.