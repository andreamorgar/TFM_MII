Preheat oven to 375 degrees F (190 degrees C). In a medium bowl, combine butter or margarine, flour and chopped walnuts. Mix, then pat into bottom of 9x13 " pan. Bake at 375 degrees F (190 degrees C) for 20 minutes. Allow to cool. Beat softened cream cheese with confectioners sugar until smooth. Fold in 1/2 of the whipped topping. Spread over cooled crust. In a medium bowl, combine chocolate pudding mix with 3 cups milk. Mix well and spread over cream cheese mixture. Spread remaining 1/2 container of whipped topping over pudding. Sprinkle with 1/2 cup chopped nuts.